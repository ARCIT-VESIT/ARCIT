{% extends 'sidebar.html' %}

{% block content %}
<style>
    body{
        color: #1a202c;
        text-align: left;
    }
    .card {
        box-shadow: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px 0 rgba(0,0,0,.06);
    }
    
    .card {
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 0 solid rgba(0,0,0,.125);
        border-radius: .25rem;
    }
    
    .card-body {
        flex: 1 1 auto;
        min-height: 1px;
        padding: 1rem;
    }
    
    .gutters-sm {
        margin-right: -8px;
        margin-left: -8px;
    }
    
    .gutters-sm>.col, .gutters-sm>[class*=col-] {
        padding-right: 8px;
        padding-left: 8px;
    }
</style>
<body>
    <div >
        
    </div>
    <div class="row gutters-sm">                
        <div class="col-md-12">
            <div class="card" style="height: calc(100vh - 105px); overflow: auto;">
                <div class="card-body">
                    <div class="row pb-3">
                        <div class="col-12 col-md-4 col-sm-6 col-xl-3">
                            
                            <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Admin" class="rounded-circle" width="150">
                            
                            <div ><h3>{{profile.user}}</h3>
                            </div>

                        </div>
                        <div class="col-12 col-md-8 col-sm-6 col-xl-9">
                            <!-- <div class="row">
                                <div class="col-sm-3"><h6 class="mb-0">Username</h6></div>
                                <div class="col-sm-9 text-secondary">{{profile.user}}</div>
                            </div>
                            <hr> -->
                            <div class="row">
                                <div class="col-sm-3"><h6 class="mb-0">Name</h6></div>
                                <div class="col-sm-9 text-secondary">{{profile.name}}</div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Email</h6>
                                </div>
                            <div class="col-sm-9 text-secondary">{{profile.email}}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Phone</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">{{profile.phone_number}}</div>
                        </div>
                        <hr>
                       
                        <!-- <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Date of birth</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">{{profile.dob}}</div>
                        </div>
                        <hr> -->
                        <div class="row">
                            <div class="col-sm-3"><h6 class="mb-0">Address</h6></div>
                            <div class="col-sm-9 text-secondary">{{profile.address}}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Registeration Number</h6>
                            </div>
                        <div class="col-sm-9 text-secondary">{{profile.doctor_registeration_no}}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Work Experience</h6>
                            </div>
                        <div class="col-sm-9 text-secondary">{{profile.experience}}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Affiliation</h6>
                            </div>
                        <div class="col-sm-9 text-secondary">{{profile.affiliation}}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Adhaar card number</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">{{profile.adharcardno}}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3"><h6 class="mb-0">Accreditation</h6></div>
                            <div class="col-sm-9 text-secondary">{{profile.accreditation}}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3"><h6 class="mb-0">Specialization</h6></div>
                            <div class="col-sm-9 text-secondary">{{profile.specialization}}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Active hours</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                {% if active_hours|length == 0 %}
                                    <a data-toggle="modal" href="#setHours">Set active hours</a>
                                {% else %}
                                    {% for active_hour in active_hours %}
                                        <div class="row">
                                            <span class="col-8 col-sm-6">
                                                {{active_hour.arrival_time}} - {{active_hour.departure_time}}
                                            </span>
                                            <span class="col-4 col-sm-6">
                                                <i class="fa fa-pencil ml-2" 
                                                    aria-hidden="true" 
                                                    data-toggle="modal" 
                                                    href="#setHours" 
                                                    data-arrival-time="{{active_hour.arrival_time}}" 
                                                    data-departure-time="{{active_hour.departure_time}}" 
                                                    data-active-hour-id={{active_hour.id}} 
                                                    data-for-hospital={{active_hour.for_hospital}} 
                                                    style="cursor: pointer;"></i>
                                                <i class="fa fa-trash ml-2" 
                                                    aria-hidden="true" 
                                                    data-toggle="modal" 
                                                    href="#deleteHours" 
                                                    data-timespan="{{active_hour.arrival_time}} : {{active_hour.departure_time}}" 
                                                    data-active-hour-id={{active_hour.id}}
                                                    style="cursor: pointer;"></i>
                                            </span>
                                            <br />
                                        </div>
                                    {% endfor %}
                                    <a class="m-0" data-toggle="modal" href="#setHours">Add more hours</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>                    
            </div>
            </div>
        </div>
    </div>
</body>

<div class="modal fade" id="setHours" tabindex="-1" role="dialog" aria-labelledby="setHoursLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <form action = "set_active_hour" method = "post">
            {% csrf_token %}
            <input type="hidden" name="doctor_id" value={{profile.user_id}} />
            <input type="hidden" name="active_hour" id="active_hour_id" />
            <div class="modal-header">
                <h5 class="modal-title" id="setHoursLabel">Set hours</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row m-0 mb-2">
                    <label for="start_time_id" class="col-sm">Arrival time:</label>
                    <input type="time" id="start_time_id" name="start_time" class="col-md" required />
                </div>
                <div class="form-group row m-0 mb-2">
                    <label for="departure_time_id" class="col-sm">Departure time:</label>
                    <input type="time" id="departure_time_id" name="departure_time" class="col-md" required />
                </div>
                <div class="form-group row m-0">
                    <div class="custom-control custom-switch ml-3">
                        <input type="checkbox" class="custom-control-input" id="hospital_switch_id" name="for_hospital">
                        <label class="custom-control-label" for="hospital_switch_id">For hospital availability</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="submit" id="add_update_button" class="btn btn-primary">Add</button>
            </div>
        </form>
    </div>
  </div>
</div>

<div class="modal fade" id="deleteHours" tabindex="-1" role="dialog" aria-labelledby="deleteHoursLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <form action = "delete_active_hour" method = "post">
            {% csrf_token %}            
            <input type="hidden" name="active_hour" id="active_hour_id" />
            <div class="modal-header">
                <h5 class="modal-title" id="deleteHoursLabel">Confirm deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                <button type="submit" id="deleteHourButtonId" class="btn btn-primary">Yes</button>
            </div>
        </form>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
    <script>
        $('#setHours').on('show.bs.modal', function (e) { setModalContent(e, true, $(this)) })
        $('#setHours').on('hide.bs.modal', function (e) { setModalContent(e, false, $(this)) })

        $('#deleteHours').on('show.bs.modal', function (e) {
            const button = $(e.relatedTarget)
            const modal = $(this)

            modal.find('.modal-body').text(`Do you wish to delete the time ${button.data('timespan')}?`)
            modal.find(".modal-content input#active_hour_id").val(button.data('active-hour-id'))
        })

        const convertTime = time => moment(time, 'hh:mm A').format('HH:mm')
        
        const setModalContent = (e, onModalShow, modal) => {
            const button = $(e.relatedTarget)
            const arrival_time = onModalShow ? button.data('arrival-time') : $("#start_time_id").val()
            const departure_time = onModalShow ? button.data('departure-time') : $("#departure_time_id").val()
            debugger

            if (arrival_time !== undefined && departure_time !== undefined) {
                const hospital_switch_input = modal.find(".modal-content input#hospital_switch_id")

                modal.find('.modal-title').text(onModalShow ? 'Update hours' : 'Set active hours')
                modal.find('.modal-footer button#add_update_button').text(onModalShow ? 'Update' : 'Add')
                
                if (onModalShow){
                    modal.find('.modal-body input#start_time_id').val(convertTime(arrival_time))
                    modal.find('.modal-body input#departure_time_id').val(convertTime(departure_time))
                    modal.find(".modal-content input#active_hour_id").val(button.data('active-hour-id'))
                    
                    if(button.data('for-hospital') == "True")
                        hospital_switch_input.attr("checked", "checked");
                }
                else
                    location.reload();
            }
        }
    </script>
{% endblock %}